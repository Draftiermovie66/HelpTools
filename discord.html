<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Help Tools + - Discord Timestamp Generator</title>
<style>
  html, body {
    margin: 0; padding: 0;
    background: #161620;
    color: #eee;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,
      Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  }
  .container {
    max-width: 50rem;
    margin: 1rem auto;
    padding: 1rem;
    border-left: 1px solid #666;
    border-right: 1px solid #666;
    display: grid;
    grid-template-columns: 1fr max-content;
    gap: 0.5rem 1rem;
    align-items: center;
  }
  .container > * {
    margin: 0.2rem 0;
  }
  #current {
    grid-column: span 2;
    justify-self: center;
    margin-top: 1rem;
  }
  label {
    font-weight: 600;
  }
  input, select, button {
    background: #383842;
    border: 1px solid #666;
    color: #eee;
    padding: 0.3rem 0.5rem;
    font-size: 1rem;
    border-radius: 3px;
  }
  input[type="text"] {
    width: 100%;
    font-family: monospace;
  }
  button {
    cursor: pointer;
  }
  #preview {
    background: #22222a;
    padding: 0.3rem 0.6rem;
    border-radius: 3px;
    font-weight: 700;
  }

  @media (max-width: 50rem) {
    .container {
      display: flex;
      flex-direction: column;
      width: 90%;
      border: none;
    }
    .container > * {
      margin: 0.5rem 0;
    }
  }
</style>
</head>
<body>
  <main>
    <div class="container" aria-label="Discord Timestamp Generator">
      <p style="grid-column: span 2;">
        Get a dynamic date-time display in your Discord messages. Choose your time and copy the code below.
      </p>
    </div>
    <form class="container" onsubmit="return false" aria-label="Timestamp input form">
      <label for="d">Date</label>
      <input type="date" id="d" name="date" required aria-required="true" />

      <label for="hm">Time</label>
      <input type="time" id="hm" name="time" required aria-required="true" />

      <label for="t">Type</label>
      <select id="t" name="type" aria-label="Timestamp format type" title="Choose the Discord timestamp format">
        <option value="t">Short time (e.g. 16:20)</option>
        <option value="T">Long time (e.g. 16:20:30)</option>
        <option value="d">Short date (e.g. 20/04/2023)</option>
        <option value="D">Long date (e.g. 20 April 2023)</option>
        <option value="f">Long date + short time (e.g. 20 April 2023 16:20)</option>
        <option value="F">Full date + time (e.g. Thursday, 20 April 2023 16:20)</option>
        <option value="R" selected>Relative (e.g. 2 months ago)</option>
      </select>

      <label for="code">Output</label>
      <input type="text" readonly id="code" aria-live="polite" aria-atomic="true" title="Discord timestamp code" />
      <button id="copy" type="button" aria-label="Copy code to clipboard">Copy to clipboard</button>

      <button id="current" type="button" aria-label="Reset to current time">Reset to current time</button>

      <span id="preview" aria-live="polite" aria-atomic="true" style="grid-column: span 2; font-size: 1.2rem; margin-top: 0.5rem;"></span>
    </form>
  </main>

  <script>
    const dateInput = document.getElementById('d');
    const timeInput = document.getElementById('hm');
    const typeInput = document.getElementById('t');
    const output = document.getElementById('code');
    const copyBtn = document.getElementById('copy');
    const currentBtn = document.getElementById('current');
    const preview = document.getElementById('preview');

    function pad(n) {
      return n.toString().padStart(2, '0');
    }

    function setCurrentDateTime() {
      const now = new Date();
      dateInput.value = now.toISOString().slice(0, 10);
      timeInput.value = pad(now.getHours()) + ':' + pad(now.getMinutes());
      updateOutput();
    }

    function getUnixTimestampSeconds(date, time) {
      if (!date || !time) return null;
      // Combine date and time strings as ISO string then to Date object
      const isoString = `${date}T${time}:00`;
      const dt = new Date(isoString);
      if (isNaN(dt.getTime())) return null;
      return Math.floor(dt.getTime() / 1000);
    }

    function automaticRelativeDifference(d) {
      const now = new Date();
      const diffSeconds = Math.floor((d.getTime() - now.getTime()) / 1000);
      const absDiff = Math.abs(diffSeconds);

      if (absDiff >= 31536000) // >= 1 year
        return { duration: Math.round(diffSeconds / 31536000), unit: 'year' };
      if (absDiff >= 2592000) // >= 1 month
        return { duration: Math.round(diffSeconds / 2592000), unit: 'month' };
      if (absDiff >= 86400) // >= 1 day
        return { duration: Math.round(diffSeconds / 86400), unit: 'day' };
      if (absDiff >= 3600) // >= 1 hour
        return { duration: Math.round(diffSeconds / 3600), unit: 'hour' };
      if (absDiff >= 60) // >= 1 minute
        return { duration: Math.round(diffSeconds / 60), unit: 'minute' };
      return { duration: diffSeconds, unit: 'second' };
    }

    function updateOutput() {
      const unixTimestamp = getUnixTimestampSeconds(dateInput.value, timeInput.value);
      if (!unixTimestamp) {
        output.value = '';
        preview.textContent = '';
        return;
      }

      const type = typeInput.value;
      output.value = `<t:${unixTimestamp}:${type}>`;

      if (type === 'R') {
        const relative = automaticRelativeDifference(new Date(unixTimestamp * 1000));
        const formatter = new Intl.RelativeTimeFormat(navigator.language || 'en', { numeric: 'auto' });
        preview.textContent = formatter.format(relative.duration, relative.unit);
      } else {
        const options = {};
        switch (type) {
          case 't': options.hour = '2-digit'; options.minute = '2-digit'; break;
          case 'T': options.hour = '2-digit'; options.minute = '2-digit'; options.second = '2-digit'; break;
          case 'd': options.year = 'numeric'; options.month = '2-digit'; options.day = '2-digit'; break;
          case 'D': options.year = 'numeric'; options.month = 'long'; options.day = 'numeric'; break;
          case 'f': options.year = 'numeric'; options.month = 'long'; options.day = 'numeric'; options.hour = '2-digit'; options.minute = '2-digit'; break;
          case 'F': options.weekday = 'long'; options.year = 'numeric'; options.month = 'long'; options.day = 'numeric'; options.hour = '2-digit'; options.minute = '2-digit'; break;
        }
        const formatter = new Intl.DateTimeFormat(navigator.language || 'en', options);
        preview.textContent = formatter.format(new Date(unixTimestamp * 1000));
      }
    }

    dateInput.addEventListener('input', updateOutput);
    timeInput.addEventListener('input', updateOutput);
    typeInput.addEventListener('change', updateOutput);
    output.addEventListener('focus', e => e.target.select());
    output.addEventListener('click', e => e.target.select());

    copyBtn.addEventListener('click', async () => {
      try {
        if (!output.value) return alert('No code to copy!');
        await navigator.clipboard.writeText(output.value);
        alert('Copied to clipboard!');
      } catch (e) {
        alert('Failed to copy: ' + e);
      }
    });

    currentBtn.addEventListener('click', () => {
      setCurrentDateTime();
    });

    // Initialize form with current time on load
    setCurrentDateTime();
  </script>
</body>
</html>
